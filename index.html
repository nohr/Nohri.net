<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>nohri</title>
  <meta name="description" content="">
  <meta name="author" content="nohri">

  <link rel="stylesheet" href="index.css">

</head>
<body class="curtains-ready video-started">
    <!-- div that will hold our WebGL canvas -->
    <div id="canvas"></div>
    <!-- div used to create our plane -->
    <div class="plane start-playing">
      <!-- image that will be used as a texture by our plane -->
      <video src="IMG_6012.mp4" preload="true" loop autoplay>
          Your browser does not support the video tag.
        </video>
    </div>
  </body>
<body>

  <script src="curtains.js"></script>
  <script src="index.js"></script>
<!-- vertex shader -->
<script id="plane-vs" type="x-shader/x-vertex">
			#ifdef GL_ES
			precision mediump float;
			#endif

			// default mandatory variables
			attribute vec3 aVertexPosition;
			attribute vec2 aTextureCoord;

			uniform mat4 uMVMatrix;
    		uniform mat4 uPMatrix;

			// custom variables
			varying vec3 vVertexPosition;
			varying vec2 vTextureCoord;

			uniform float uMouseTime;
			uniform vec2 uMousePosition;
			uniform float uMouseMoveStrength;


			void main() {

				vec3 vertexPosition = aVertexPosition;

				// fix the curtain on top (y coord ranges from top : 1.0 to bottom : -1.0)
				float yCoordRatio = vertexPosition.y - 1.0;


				float distanceFromMouse = distance(vec2(uMousePosition.x, 0.0), vec2(vertexPosition.x, 0.0));

				float waveSinusoid = cos(10.0 * 1.5 * ((1.0 / (distanceFromMouse - 2.0)) - (uMouseTime / 500.0)));

				float xAttenuation = ((2.0 - abs(uMousePosition.x - vertexPosition.x)) / 2.0);
				float yAttenuation = ((-1.0 * uMousePosition.y) + 1.0) / 2.0;
				if(uMousePosition.y <= -1.0) {
					yAttenuation = yAttenuation + (uMousePosition.y + 1.0) * 1.5;
				}
				yAttenuation = clamp(yAttenuation, 0.0, 1.0);

				float curtainEffect = yCoordRatio  * waveSinusoid * uMouseMoveStrength * xAttenuation * yAttenuation;

				float xDisplacement = abs(yCoordRatio) * sign(vertexPosition.x);

				vertexPosition.z +=  curtainEffect / 15.0;
				vertexPosition.x +=  curtainEffect * 1.5 * xDisplacement / 120.0;

			   	gl_Position = uPMatrix * uMVMatrix * vec4(vertexPosition, 1.0);

			   	// varyings
			   	vTextureCoord = aTextureCoord;
			   	vVertexPosition = vertexPosition;
			}
        </script>
<!-- fragment shader -->
<script id="plane-fs" type="x-shader/x-fragment">
    #ifdef GL_ES
    precision mediump float;
    #endif

    varying vec3 vVertexPosition;
    varying vec2 vTextureCoord;

    uniform sampler2D curtainSampler;
    uniform sampler2D titleSampler;


    void main( void ) {

        vec2 textureCoords = vec2(vTextureCoord.x, vTextureCoord.y);

        // slides transitions
        vec4 finalColor = texture2D(curtainSampler, textureCoords);
        vec4 title = texture2D(titleSampler, textureCoords);

        finalColor = mix(finalColor, title, title.a);

        finalColor.rgb -= clamp(-vVertexPosition.z / 5.0, 0.0, 1.0);
        finalColor.rgb += clamp(vVertexPosition.z / 5.0, 0.0, 1.0);

        // handling premultiplied alpha
        finalColor = vec4(finalColor.rgb * finalColor.a, finalColor.a);

        gl_FragColor = finalColor;
    }
</script>
</body>
</html>